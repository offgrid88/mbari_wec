<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://example.com/Tutorials/ROS2/CPPTemplate/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Quick Start &mdash; Writing External Controller With GitHub Template Repository - MBARI-WEC</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Quick Start \u0026mdash; Writing External Controller With GitHub Template Repository";
        var mkdocs_page_input_path = "Tutorials/ROS2/CPPTemplate.md";
        var mkdocs_page_url = "/Tutorials/ROS2/CPPTemplate/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> MBARI-WEC
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../ControlAndTelemetry/">Buoy Control and Telemetry</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../ros2/">ROS2 Interface</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../simulation/">Simulation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../atseaoperation/">At Sea Operation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/">Tutorials</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../resources/">Resources</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../theory/">Theory</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../license/">License</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../citation/">How to Cite</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">MBARI-WEC</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Quick Start &mdash; Writing External Controller With GitHub Template Repository</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="quick-start-writing-external-controller-with-github-template-repository">Quick Start &mdash; Writing External Controller With GitHub Template Repository</h1>
<hr />
<p>In this tutorial, you will make and customize a GitHub repository from a GitHub Template with
a ROS 2 C++ package and code ready to implement your own external controller utilizing the
<code>buoy_api_cpp</code> interface. This interface may be used with the both the simulated and physical buoy.</p>
<h2 id="interfaces-and-templates">Interfaces and Templates</h2>
<p>There are two GitHub
<a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-repository-from-a-template">template repositories</a>
set up (C++/Python) for a quick start on writing a
custom controller utilizing
<a href="https://github.com/osrf/buoy_msgs/tree/main/buoy_api_cpp">buoy_api_cpp</a> and
<a href="https://github.com/osrf/buoy_msgs/tree/main/buoy_api_py">buoy_api_py</a>. Please see
<a href="https://github.com/osrf/buoy_msgs/tree/main/buoy_api_cpp/examples">C++ examples</a> and
<a href="https://github.com/osrf/buoy_msgs/tree/main/buoy_api_py/buoy_api/examples">Python examples</a> for
example controller implementations.</p>
<ul>
<li><a href="https://github.com/mbari-org/mbari_wec_template_cpp">mbari_wec_template_cpp</a></li>
<li><a href="https://github.com/mbari-org/mbari_wec_template_py">mbari_wec_template_py</a></li>
</ul>
<hr />
<h2 id="using-c-template">Using C++ Template</h2>
<h3 id="creating-your-own-repo-from-the-template">Creating your own repo from the template</h3>
<p>You may also refer to GitHub's
<a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-repository-from-a-template">template documentation</a></p>
<p>To start using the C++ GitHub template</p>
<ol>
<li>
<p>Navigate to
<a href="https://github.com/mbari-org/mbari_wec_template_cpp">mbari_wec_template_cpp</a> and click the green
button with the text <code>Use this template</code> and select <code>Create a new repository</code></p>
<p><img alt="use_this_template" src="../resources/use_this_template_cpp.png" /></p>
</li>
<li>
<p>Next, set up the repository like you would any new GitHub repository choosing the owner,
repository name, public/private, etc.</p>
</li>
<li>
<p>Now that your new repository is set up, clone it to your local machine, make a branch, etc.<br />
<code>$ git clone https://github.com/&lt;owner&gt;/&lt;repo_name&gt;.git</code></p>
</li>
</ol>
<p>You should now have a C++ ROS 2 package with the following structure:</p>
<div class="highlight"><pre><span></span><code>&lt;repo_name&gt;
    ├── CMakeLists.txt
    ├── config
    │   └── controller.yaml
    ├── include
    │   └── mbari_wec_template_cpp
    │       ├── controller.hpp
    │       └── control_policy.hpp
    ├── launch
    │   └── controller.launch.py
    ├── LICENSE
    ├── package.xml
    ├── README.md
    └── src
        └── controller.cpp
</code></pre></div>
<h3 id="customizing-the-controller">Customizing the controller</h3>
<p>You may also refer to the <code>README.md</code> in your newly cloned repository.</p>
<h4 id="modify-template-for-your-package">Modify template for your package</h4>
<p>Replace <code>mbari_wec_template_cpp</code> with your package name and modify other fields as necessary in:</p>
<ul>
<li><code>package.xml</code> (lines 4-8)</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">package.xml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;?xml-model href=&quot;http://download.ros.org/schema/package_format3.xsd&quot; schematypens=&quot;http://www.w3.org/2001/XMLSchema&quot;?&gt;</span>
<span class="nt">&lt;package</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
<span class="hll"><span class="w">  </span><span class="nt">&lt;name&gt;</span>repo_name<span class="nt">&lt;/name&gt;</span><span class="w">  </span><span class="cm">&lt;!-- Update package name --&gt;</span>
</span><span class="hll"><span class="w">  </span><span class="nt">&lt;version&gt;</span>3.14<span class="nt">&lt;/version&gt;</span><span class="w">  </span><span class="cm">&lt;!-- Update version --&gt;</span>
</span><span class="hll"><span class="w">  </span><span class="nt">&lt;description&gt;</span>Your<span class="w"> </span>Controller<span class="w"> </span>Description<span class="nt">&lt;/description&gt;</span><span class="w">  </span><span class="cm">&lt;!-- Update description --&gt;</span>
</span><span class="hll"><span class="w">  </span><span class="nt">&lt;maintainer</span><span class="w"> </span><span class="na">email=</span><span class="s">&quot;your@email&quot;</span><span class="nt">&gt;</span>Your<span class="w"> </span>Name<span class="nt">&lt;/maintainer&gt;</span><span class="w">  </span><span class="cm">&lt;!-- Update email and name --&gt;</span>
</span><span class="hll"><span class="w">  </span><span class="nt">&lt;license&gt;</span>Your<span class="w"> </span>License<span class="nt">&lt;/license&gt;</span><span class="w">  </span><span class="cm">&lt;!-- Update license --&gt;</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li><code>CMakeLists.txt</code> (line 2)</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CMakeLists.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.8</span><span class="p">)</span>
<span class="hll"><span class="nb">project</span><span class="p">(</span><span class="s">mbari_wec_template_cpp</span><span class="p">)</span><span class="w">  </span><span class="c"># Update ${PROJECT_NAME}</span>
</span>
<span class="nb">if</span><span class="p">(</span><span class="s">CMAKE_COMPILER_IS_GNUCXX</span><span class="w"> </span><span class="s">OR</span><span class="w"> </span><span class="s">CMAKE_CXX_COMPILER_ID</span><span class="w"> </span><span class="s">MATCHES</span><span class="w"> </span><span class="s2">&quot;Clang&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">add_compile_options</span><span class="p">(</span><span class="s">-Wall</span><span class="w"> </span><span class="s">-Wextra</span><span class="w"> </span><span class="s">-Wpedantic</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c"># find dependencies</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">rclcpp</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">buoy_interfaces</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">buoy_api_cpp</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">COMPONENTS</span><span class="w"> </span><span class="s">buoy_api</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">src/controller.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">buoy_api_cpp::buoy_api</span><span class="p">)</span>
<span class="nb">ament_target_dependencies</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">rclcpp</span><span class="w"> </span><span class="s">buoy_interfaces</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span>
<span class="w">  </span><span class="o">$&lt;</span><span class="nv">BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">$&lt;</span><span class="nv">INSTALL_INTERFACE:include</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nb">target_compile_features</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">c_std_99</span><span class="w"> </span><span class="s">cxx_std_17</span><span class="p">)</span><span class="w">  </span><span class="c"># Require C99 and C++17</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>launch/controller.launch.py</code> (line 22)</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">launch/controller.launch.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;your_package_name&#39;</span>   <span class="c1"># Update package name (same as in CMakeLists.txt)</span>
</span>
<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="n">LaunchDescription</span><span class="p">()</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">get_package_share_directory</span><span class="p">(</span><span class="n">package_name</span><span class="p">),</span>
        <span class="s1">&#39;config&#39;</span><span class="p">,</span>
        <span class="s1">&#39;controller.yaml&#39;</span>
        <span class="p">)</span>

    <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>  <span class="c1"># ensure same as name in config.yaml</span>
        <span class="n">executable</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>config/controller.yaml</code> (line 1)<br />
    Update first line with your controller name (same as node name in launch file)</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">config/controller.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="nt">/your_controller_name</span><span class="p">:</span>
</span><span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</code></pre></div></td></tr></table></div>
<p>and rename the folder</p>
<ul>
<li><code>include/mbari_wec_template_cpp</code> (containing <code>controller.hpp</code> and <code>control_policy.hpp</code>) to your
  package name</li>
</ul>
<p>resulting in the following folder structure:</p>
<div class="highlight"><pre><span></span><code>&lt;your_package_name&gt;
    ├── CMakeLists.txt
    ├── config
    │   └── controller.yaml
    ├── include
    │   └── &lt;your_package_name&gt;
    │       ├── controller.hpp
    │       └── control_policy.hpp
    ├── launch
    │   └── controller.launch.py
    ├── LICENSE
    ├── package.xml
    ├── README.md
    └── src
        └── controller.cpp
</code></pre></div>
<p>Update the include paths in</p>
<ul>
<li>
<p><code>controller.cpp</code> (lines 15-16)
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">src/controller.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mbari_wec_template_cpp/control_policy.hpp&gt;</span><span class="c1">  // update include path</span>
</span><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mbari_wec_template_cpp/controller.hpp&gt;</span><span class="c1">  // update include path</span>
</span></code></pre></div></td></tr></table></div></p>
</li>
<li>
<p><code>control_policy.hpp</code> (line 15)
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">include/your_package_name/control_policy.hpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mbari_wec_template_cpp/controller.hpp&gt;</span><span class="c1">  // update include path</span>
</span></code></pre></div></td></tr></table></div></p>
</li>
</ul>
<p>Update include guards in</p>
<ul>
<li>
<p><code>controller.hpp</code>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">include/your_package_name/controller.hpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="cp">#ifndef YOUR_PACKAGE_NAME__CONTROLLER_HPP_</span>
</span><span class="hll"><span class="cp">#define YOUR_PACKAGE_NAME__CONTROLLER_HPP_</span>
</span></code></pre></div></td></tr></table></div>
<code>...</code>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="cp">#endif  </span><span class="c1">// YOUR_PACKAGE_NAME__CONTROLLER_HPP_</span>
</span></code></pre></div></td></tr></table></div></p>
</li>
<li>
<p><code>control_policy.hpp</code>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">include/your_package_name/control_policy.hpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="cp">#ifndef YOUR_PACKAGE_NAME__CONTROL_POLICY_HPP_</span>
</span><span class="hll"><span class="cp">#define YOUR_PACKAGE_NAME__CONTROL_POLICY_HPP_</span>
</span></code></pre></div></td></tr></table></div>
<code>...</code>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="cp">#endif  </span><span class="c1">// YOUR_PACKAGE_NAME__CONTROL_POLICY_HPP_</span>
</span></code></pre></div></td></tr></table></div></p>
</li>
</ul>
<p>Modify <code>CMakeLists.txt</code> as desired and add any dependencies in <code>package.xml</code> following standard
ROS 2 documentation.</p>
<hr />
<h2 id="implement-controller">Implement Controller</h2>
<p>Assuming you have followed the above,</p>
<ul>
<li><code>include/&lt;your_package_name&gt;/control_policy.hpp</code></li>
<li><code>src/controller.cpp</code></li>
</ul>
<p>are stubbed out to implement your custom external controller. You may also use
<code>config/controller.yaml</code> for any policy parameters.</p>
<h3 id="controlpolicy">ControlPolicy</h3>
<p>You may use the struct <code>ControlPolicy</code> in <code>control_policy.hpp</code> to implement your controller.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">ControlPolicy</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// declare/init any parameter variables here</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">foo</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">bar</span><span class="p">{</span><span class="mf">10.0</span><span class="o">*</span><span class="n">foo</span><span class="p">};</span>

<span class="w">  </span><span class="n">ControlPolicy</span><span class="p">()</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">foo</span><span class="p">{</span><span class="mf">1.0</span><span class="p">},</span>
<span class="w">    </span><span class="n">bar</span><span class="p">{</span><span class="mf">10.0</span><span class="o">*</span><span class="n">foo</span><span class="p">}</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">update_params</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Update dependent variables after reading in params</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">update_params</span><span class="p">()</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="o">*</span><span class="n">foo</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Modify function inputs as desired</span>
<span class="w">  </span><span class="c1">// Calculate target value from feedback inputs</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">target</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cm">/*some*/</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cm">/*feedback*/</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cm">/*values*/</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// secret sauce</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w">  </span><span class="c1">// obviously, modify to return proper target value</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>declare/define any configurable parameters in the struct and init list</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1">// declare/init any parameter variables here</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">foo</span><span class="p">{</span><span class="mf">1.0</span><span class="p">};</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">bar</span><span class="p">{</span><span class="mf">10.0</span><span class="o">*</span><span class="n">foo</span><span class="p">};</span>

<span class="w">  </span><span class="n">ControlPolicy</span><span class="p">()</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">foo</span><span class="p">{</span><span class="mf">1.0</span><span class="p">},</span>
<span class="w">    </span><span class="n">bar</span><span class="p">{</span><span class="mf">10.0</span><span class="o">*</span><span class="n">foo</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Set any dependent variables in <code>update_params</code> on line 39</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code>  <span class="o">//</span> <span class="n">Update</span> <span class="n">dependent</span> <span class="n">variables</span> <span class="n">after</span> <span class="n">reading</span> <span class="ow">in</span> <span class="n">params</span>
  <span class="n">void</span> <span class="n">update_params</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">*</span><span class="n">foo</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Declare/get/update params in the <code>set_params</code> function of the <code>Controller</code> class on line 58</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Use ROS2 declare_parameter and get_parameter to set policy params</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Controller::set_params</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">policy_</span><span class="o">-&gt;</span><span class="n">foo</span><span class="p">);</span>
<span class="w">  </span><span class="n">policy_</span><span class="o">-&gt;</span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">).</span><span class="n">as_double</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// recompute any dependent variables</span>
<span class="w">  </span><span class="n">policy_</span><span class="o">-&gt;</span><span class="n">update_params</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Then, your control logic will go in the <code>target</code> function on line 46.
    Modify the input args as well as the return value as necessary</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1">// Modify function inputs as desired</span>
<span class="w">  </span><span class="c1">// Calculate target value from feedback inputs</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="nf">target</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cm">/*some*/</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cm">/*feedback*/</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cm">/*values*/</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// secret sauce</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w">  </span><span class="c1">// obviously, modify to return proper target value</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="controller">Controller</h3>
<p>The <code>Controller</code> class contains an instance of <code>ControlPolicy</code> as the member variable,
<code>this-&gt;policy</code>. The <code>this-&gt;policy-&gt;target</code> function may be called anywhere within the
<code>Controller</code> class. You may call it inside any of the data callbacks to enable feedback
control (for example):</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1">// To subscribe to any topic, simply declare &amp; define the specific callback, e.g. power_callback</span>

<span class="w">  </span><span class="c1">// Callback for &#39;/power_data&#39; topic from Power Controller</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">power_callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">buoy_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PCRecord</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get target value from control policy</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">wind_curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">policy_</span><span class="o">-&gt;</span><span class="n">target</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">rpm</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">scale</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">retract</span><span class="p">);</span>

<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">send_pc_wind_curr_command</span><span class="p">(</span><span class="n">wind_curr</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
<p>Or, set up a loop in <code>main</code> and run open-loop:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Controller</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;controller&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Rate</span><span class="w"> </span><span class="n">rate</span><span class="p">(</span><span class="mf">50.0</span><span class="p">);</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">spin_once</span><span class="p">(</span><span class="n">controller</span><span class="p">);</span>
<span class="w">    </span><span class="n">rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>You may get feedback data from any of the buoy topics by simply creating a specific callback
listed below. For feedback data you'd like to use in another area of the class, feel free to
assign them to class variables.</p>
<p>(Delete any callbacks you don't need in the <code>Controller</code> class)</p>
<p>Available callback functions:</p>
<p><code>/ahrs_data</code> &rarr; <code>void ahrs_callback(const buoy_interfaces::msg::XBRecord &amp; data){}</code><br />
<code>/battery_data</code> &rarr; <code>void battery_callback(const buoy_interfaces::msg::BCRecord &amp; data){}</code><br />
<code>/spring_data</code> &rarr; <code>void spring_callback(const buoy_interfaces::msg::SCRecord &amp; data){}</code><br />
<code>/power_data</code> &rarr; <code>void power_callback(const buoy_interfaces::msg::PCRecord &amp; data){}</code><br />
<code>/trefoil_data</code> &rarr; <code>void trefoil_callback(const buoy_interfaces::msg::TFRecord &amp; data){}</code><br />
<code>/powerbuoy_data</code> &rarr; <code>void powerbuoy_callback(const buoy_interfaces::msg::PBRecord &amp; data){}</code>  </p>
<p>You may also send commands from within the <code>Controller</code> class:</p>
<p><code>this-&gt;send_pump_command(duration_mins);</code><br />
<code>this-&gt;send_valve_command(duration_sec);</code><br />
<code>this-&gt;send_pc_wind_curr_command(wind_curr_amps);</code><br />
<code>this-&gt;send_pc_bias_curr_command(bias_curr_amps);</code><br />
<code>this-&gt;send_pc_scale_command(scale_factor);</code><br />
<code>this-&gt;send_pc_retract_command(retract_factor);</code>  </p>
<p>In the <code>Controller</code> constructor, you may also uncomment lines 31 or 32 to set the publish rates for
the Spring or Power Controllers on the buoy. These controllers default to publishing at 10Hz. You
can call commands to set the rates anywhere from 10Hz to 50Hz (default argument is 50Hz).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">Controller</span><span class="o">::</span><span class="n">Controller</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">node_name</span><span class="p">)</span>
<span class="o">:</span><span class="w"> </span><span class="n">buoy_api</span><span class="o">::</span><span class="n">Interface</span><span class="o">&lt;</span><span class="n">Controller</span><span class="o">&gt;</span><span class="p">(</span><span class="n">node_name</span><span class="p">),</span>
<span class="w">  </span><span class="n">policy_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ControlPolicy</span><span class="o">&gt;</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">set_params</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// set packet rates from controllers here</span>
<span class="w">  </span><span class="c1">// controller defaults to publishing @ 10Hz</span>
<span class="w">  </span><span class="c1">// call these to set rate to 50Hz or provide argument for specific rate</span>
<span class="w">  </span><span class="c1">// this-&gt;set_sc_pack_rate_param();  // set SC publish rate to 50Hz</span>
<span class="w">  </span><span class="c1">// this-&gt;set_pc_pack_rate_param();  // set PC publish rate to 50Hz</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="example">Example</h2>
<p>An example using this interface will follow in the next tutorial:
<a href="../CppLinearDamperExample/">Linear Damper Example (C++)</a></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
